<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Saves Lives +</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        /* Estilos para o layout */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #00509E;
            color: white;
            padding: 10px 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000; /* Garante que o cabe√ßalho fique acima do conte√∫do */
        }

        .header h1 {
            margin: 0;
        }

        #create-alert-btn {
            background-color: #fff;
            color: #D32F2F;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }

        .header a {
            background-color: #ffffff;
            color: #D32F2F;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid #D32F2F;
        }

        .header a:hover {
            background-color: #D32F2F; /* Fundo vermelho quando passar o mouse */
            color: white; /* Texto branco ao passar o mouse */
        }

        /* Estilos para as abas superiores */
        .top-tabs {
            display: flex;
            justify-content: center;
            background-color: #f1f1f1;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        #tabs {
            display: flex;
            justify-content: center;
            background-color: #fff;
            border-bottom: 2px solid #ddd;
            margin: 0;
            padding: 0;
        }

        .top-tab {
            /* flex: 1;
            text-align: center;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            font-weight: bold;
            color: #333;
            border: 1px solid #ddd;
            transition: background-color 0.3s, color 0.3s; */
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            cursor: pointer;
            font-size: 1em;
            color: #555;
            border-bottom: 3px solid transparent;
            transition: color 0.3s, border-bottom 0.3s;
        }

        .top-tab:hover, .top-tab.active {
            /* background-color: #4A90E2;
            color: white; */
            color: #D32F2F;
            border-bottom: 3px solid #D32F2F;
            font-weight: bold;
        }

        .content {
            display: none;
            padding: 20px;
        }

        .content.active {
            display: block;
        }

        #map-container {
            display: flex;
            width: 95%;
            max-width: 1600px;
            margin: 20px auto 0 auto;  /* Adiciona um margin-top para afastar do cabe√ßalho */
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            height: 70vh; /* Reduz a altura do cont√™iner */
        }

        #map {
            height: 100%;
            width: 60%; /* Diminui a largura do mapa */
        }

        #info-container {
            width: 40%; /* Ajusta a largura do cont√™iner de informa√ß√µes */
            padding: 20px;
            background-color: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            border-radius: 0 10px 10px 0;
        }

        #tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .tab {
            flex: 1;
            padding: 7px 14px;
            text-align: center;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            font-size: 0.9em;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tab:hover, .tab.active {
            background-color: #00509E;
            color: white;
        }

        .tab-content {
            display: none;
            margin-top: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .forecast-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .forecast-item {
            margin-bottom: 10px;
        }

        /* Estrutura geral da p√°gina */
        .page-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Ocupa toda a altura da janela */
        }

        /* √Årea de conte√∫do */
        .content {
            flex: 1; /* Faz o conte√∫do ocupar o espa√ßo dispon√≠vel */
            padding: 20px;
        }

        /* Rodap√© */
        .footer {
            text-align: center;
            padding: 10px 20px;
            background-color: #f7f7f7;
            color: #555;
            font-family: 'Arial', sans-serif;
            font-size: 0.9em;
            border-top: 1px solid #e0e0e0;
        }

        .footer p {
            margin: 5px 0;
            font-style: italic;
            color: #777;
        }

        .footer p:first-child {
            font-size: 1em;
            font-style: italic;
            color: #555;
        }

        /* Estilo geral */
        #result-tab {
            padding: 40px 20px;
            font-family: 'Arial', sans-serif;
            color: #333;
        }

        /* Cabe√ßalho */
        .result-header h2 {
            font-size: 2.2em;
            color: #00509E;
            margin-bottom: 10px;
            text-align: center;
        }

        .result-header p {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Cart√µes */
        .result-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            justify-content: center;
            align-items: stretch;
        }

        .result-card {
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s, transform 0.3s;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .result-card h3 {
            font-size: 1.5em;
            color: #00509E;
            margin-bottom: 10px;
        }

        .result-card p {
            font-size: 1em;
            color: #666;
            line-height: 1.5;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .result-header h2 {
                font-size: 1.8em;
            }

            .result-card h3 {
                font-size: 1.3em;
            }

            .result-card p {
                font-size: 0.9em;
            }
        }

        .forecast-day {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .forecast-header {
            background-color: #4caf50;
            color: white;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        .forecast-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            padding: 10px;
        }

        .forecast-item {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 30%;
            margin: 10px 0;
            padding: 10px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .forecast-item .time {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .forecast-item .details {
            font-size: 0.9em;
            color: #555;
        }

        .forecast-item .temperature {
            font-size: 1.1em;
            color: #f44336;
        }

        .forecast-item .weather {
            font-size: 1em;
            color: #2196f3;
        }

        #estado-alerta {
            font-weight: bold;
            color: #d32f2f;
        }

        #estado-alerta:empty {
            color: #388e3c;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Saves Lives +</h1>
        <a id="create-alert-btn" href="/alertas/criar">Criar Alerta</a>
    </div>
    <!-- Abas principais -->
    <div class="top-tabs">
        <div class="top-tab active" data-tab="home-tab">Home</div>
        <div class="top-tab" data-tab="map-tab">Mapa Interativo</div>
        <div class="top-tab" data-tab="result-tab">Resultados</div>
    </div>

    <div id="home-tab" class="content active" style="text-align: center; padding: 30px;">
        <h2 style="font-size: 2.5em; color: #00509E; margin-bottom: 20px;">
            Bem-vindo ao <span style="color: #D32F2F; font-weight: bold;">Saves Lives +</span>!
        </h2>
        <p style="font-size: 1.3em; color: #444; line-height: 1.6; margin-bottom: 30px;">
            Sua plataforma para monitorar <span style="color: #4CAF50; font-weight: bold;">eventos clim√°ticos</span>, 
            gerenciar <span style="color: #D32F2F; font-weight: bold;">alertas cr√≠ticos</span> 
            e coordenar <span style="color: #FF9800; font-weight: bold;">opera√ß√µes de resgate</span> em tempo real.
        </p>
        <hr style="margin: 30px auto; width: 80%; border: 0; border-top: 2px solid #E0E0E0;">
    
        <!-- Centralizando os cards com flexbox -->
        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 30px;">
            <!-- Card 1: Monitoramento Clim√°tico -->
            <div style="background-color: #f4f4f4; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 280px;">
                <div style="font-size: 2em; color: #4CAF50; margin-bottom: 15px;">üå©Ô∏è</div>
                <h3 style="color: #4CAF50; margin-bottom: 10px; font-size: 1.2em;">Monitoramento Clim√°tico</h3>
                <p style="font-size: 1.1em; color: #444;">Acompanhe os eventos clim√°ticos em tempo real, com dados atualizados constantemente para garantir que sua equipe esteja sempre informada.</p>
            </div>
            <!-- Card 2: Alertas Personalizados -->
            <div style="background-color: #f4f4f4; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 280px;">
                <div style="font-size: 2em; color: #D32F2F; margin-bottom: 15px;">‚ö†Ô∏è</div>
                <h3 style="color: #D32F2F; margin-bottom: 10px; font-size: 1.2em;">Alertas Personalizados</h3>
                <p style="font-size: 1.1em; color: #444;">Crie alertas personalizados para situa√ß√µes cr√≠ticas, com notifica√ß√µes em tempo real para a√ß√µes imediatas da equipe.</p>
            </div>
            <!-- Card 3: Gest√£o de Resgate -->
            <div style="background-color: #f4f4f4; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 280px;">
                <div style="font-size: 2em; color: #FF9800; margin-bottom: 15px;">üöë</div>
                <h3 style="color: #FF9800; margin-bottom: 10px; font-size: 1.2em;">Gest√£o de Resgate</h3>
                <p style="font-size: 1.1em; color: #444;">Otimize as opera√ß√µes de resgate com uma gest√£o inteligente, coordenando rotas de maneira eficiente para salvar vidas com rapidez.</p>
            </div>
        </div>
    </div>  

    <div id="map-tab" class="content">
        <div id="map-container">
            <div id="map"></div>
            <div id="info-container">
                <div id="tabs">
                    <div class="tab active" data-tab="info">Informa√ß√µes do Estado</div>
                    <div class="tab" data-tab="previsao">Previs√£o por Hora</div>
                    <div class="tab" data-tab="rotas">Rotas de Resgate</div>
                </div>
                <div id="info-content" class="tab-content active">
                    <h3>Informa√ß√µes do Estado</h3>
                    <p id="estado-nome">Clique em um estado para ver as informa√ß√µes.</p>
                    <p id="estado-temperatura"></p>
                    <p id="estado-clima"></p>
                    <p id="estado-umidade"></p>
                    <p id="estado-vento"></p>
                    <p id="estado-alerta"></p>
                </div>
                <div id="previsao-content" class="tab-content">
                    <h3>Previs√£o do Tempo para <span id="previsao-estado-nome">Estado</span></h3>
                    <div id="estado-previsao" class="forecast-container"></div>
                </div>
                <div id="rotas-content" class="tab-content">
                    <h3>Rotas de Resgate</h3>
                    <ul id="lista-rotas"></ul>
                </div>
            </div>
        </div>
    </div>

    <div id="result-tab" class="content">
        <div class="result-header">
            <h2>Resultados Recentes</h2>
            <p>Acompanhe os dados e relat√≥rios mais recentes sobre condi√ß√µes clim√°ticas e opera√ß√µes realizadas.</p>
        </div>
        <div class="result-cards">
            <div class="result-card">
                <h3>Monitoramento Clim√°tico</h3>
                <p>Gr√°ficos interativos e relat√≥rios atualizados com informa√ß√µes detalhadas das condi√ß√µes meteorol√≥gicas em √°reas cr√≠ticas.</p>
            </div>
            <div class="result-card">
                <h3>Alertas Cr√≠ticos</h3>
                <p>Notifica√ß√µes recentes de situa√ß√µes de emerg√™ncia, incluindo tempo de resposta m√©dio e √°reas mais afetadas.</p>
            </div>
            <div class="result-card">
                <h3>Opera√ß√µes de Resgate</h3>
                <p>Relat√≥rios detalhados sobre opera√ß√µes de resgate realizadas, incluindo rotas otimizadas e recursos mobilizados.</p>
            </div>
            <div class="result-card">
                <h3>An√°lise de Dados Clim√°ticos</h3>
                <p>Compara√ß√£o de padr√µes clim√°ticos com base em an√°lises hist√≥ricas e previs√µes futuras para 2024.</p>
            </div>
            <div class="result-card">
                <h3>Resumo Semanal</h3>
                <p>Um panorama consolidado dos eventos clim√°ticos mais importantes e a√ß√µes realizadas nos √∫ltimos 7 dias.</p>
            </div>
            <div class="result-card">
                <h3>Impacto Operacional</h3>
                <p>Estat√≠sticas e insights sobre como nossas opera√ß√µes est√£o salvando vidas e minimizando danos em √°reas cr√≠ticas.</p>
            </div>
        </div>
    </div>    

    <footer class="footer">
        <p>‚ÄúNossa miss√£o √© salvar vidas com tecnologia e inova√ß√£o.‚Äù</p>
        <p>¬© 2024 Saves Lives +. Todos os direitos reservados.</p>
    </footer>

    <script>
         document.addEventListener("DOMContentLoaded", function () {
        
        let map;
        let selectedLayer = null;
        let originalZoom;
        let originalCenter;

        // Fun√ß√£o para inicializar o mapa
        function initializeMap() {
            if (map) return;

            map = L.map('map').setView([-14.235, -51.9253], 4);
            originalZoom = map.getZoom();
            originalCenter = map.getCenter();

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // Carrega o GeoJSON
            fetch('/static/brazil-states.geojson')
                .then(response => response.json())
                .then(brazilStatesGeoJson => {
                    const geoJsonLayer = L.geoJson(brazilStatesGeoJson, {
                        style: function(feature) {
                            return { color: "#555", weight: 1, fillColor: "#80c2af", fillOpacity: 0.7 };
                        },
                        onEachFeature: function (feature, layer) {
                            layer.on('click', function () {
                                if (selectedLayer) {
                                    geoJsonLayer.resetStyle(selectedLayer);
                                }
                                layer.setStyle({ fillColor: "#4CAF50", fillOpacity: 0.9 });
                                selectedLayer = layer;

                                const estado = feature.properties.name;
                                document.getElementById("previsao-estado-nome").textContent = estado;
                                buscarDadosClimaticos(estado);
                                buscarPrevisao(estado);
                            });
                        }
                    }).addTo(map);
                })
                .catch(error => console.error("Erro ao carregar o GeoJSON:", error));
        }

        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");

        tabs.forEach(tab => {
            tab.addEventListener("click", () => {
                tabs.forEach(t => t.classList.remove("active"));
                tabContents.forEach(content => content.classList.remove("active"));
                tab.classList.add("active");
                document.getElementById(`${tab.dataset.tab}-content`).classList.add("active");

                if (tab.dataset.tab !== 'rotas') {
                    map.setView(originalCenter, originalZoom);
                }
            });
        });

        // Alternar entre abas principais (Home, Mapa, Resultados)
        const topTabs = document.querySelectorAll(".top-tab");
        const topContents = document.querySelectorAll(".content");

        topTabs.forEach(tab => {
            tab.addEventListener("click", () => {
                topTabs.forEach(t => t.classList.remove("active"));
                topContents.forEach(c => c.classList.remove("active"));
                tab.classList.add("active");
                const activeContent = document.getElementById(tab.dataset.tab);
                activeContent.classList.add("active");

                if (tab.dataset.tab === "map-tab") {
                    initializeMap();  
                    map.setView(originalCenter, originalZoom);  
                }
            });
        });
        function carregarRotas() {
    fetch("/rotas")
        .then(response => response.json())
        .then(data => {
            const cores = ["blue", "red", "green", "purple", "orange"];
            const rotasMap = []; 

            data.rotas.forEach((rota, index) => {
                const cor = cores[index % cores.length]; 

                const polyline = L.polyline(
                    rota.coordenadas.map(coord => [coord.latitude, coord.longitude]),
                    { color: cor, weight: 4, opacity: 0.7 } 
                ).addTo(map);

                rotasMap.push(polyline); 

                const rotaItem = document.createElement("li");
                rotaItem.textContent = rota.nome;
                rotaItem.style.cursor = 'pointer';
                rotaItem.style.color = cor;

                rotaItem.addEventListener("click", () => {
                    rotasMap.forEach(r => r.setStyle({ opacity: 0.3 }));

                    polyline.setStyle({ opacity: 1 });

                    map.fitBounds(polyline.getBounds());
                });

                document.getElementById("lista-rotas").appendChild(rotaItem);
            });
        })
        .catch(error => console.error("Erro ao carregar rotas:", error));
}

            document.querySelector(".tab[data-tab='rotas']").addEventListener("click", carregarRotas);
            function buscarDadosClimaticos(estado) {
            fetch(`/clima/estado?estado=${estado}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("estado-nome").innerHTML = `üìç <strong>Estado:</strong> ${data.local}`;
                    document.getElementById("estado-temperatura").innerHTML = `üå°Ô∏è <strong>Temperatura:</strong> ${data.temperatura} ¬∞C`;
                    document.getElementById("estado-clima").innerHTML = `‚òÅÔ∏è <strong>Clima:</strong> ${data.clima}`;
                    document.getElementById("estado-umidade").innerHTML = `üíß <strong>Umidade:</strong> ${data.umidade}%`;
                    document.getElementById("estado-vento").innerHTML = `üå¨Ô∏è <strong>Vento:</strong> ${data.vento} km/h`;

                    if (data.alerta && data.alerta.length > 0 && data.alerta[0] !== "Nenhum alerta ativo") {
                        document.getElementById("estado-alerta").innerHTML = data.alerta
                            .map(alerta => `<li>‚ö†Ô∏è ${alerta}</li>`)
                            .join("");
                    } else {
                        document.getElementById("estado-alerta").innerHTML = "‚úÖ Nenhum alerta ativo";
                    }
                })
                .catch(error => console.error("Erro ao obter dados do clima:", error));
        }
            function buscarPrevisao(estado) {
                fetch(`/clima/estado/previsao?estado=${estado}`)
                    .then(response => response.json())
                    .then(data => {
                        let previsaoHtml = "";
                        let currentDay = "";
                        let dayCounter = -1;
                        data.previsoes.forEach(previsao => {
                            const [date, time] = previsao.data_hora.split(" ");
                            const [ano, mes, dia] = date.split("-");
                            const dataFormatada = `${dia}/${mes}/${ano}`;

                            if (date !== currentDay) {
                                currentDay = date;
                                dayCounter++;

                                if (dayCounter > 0) {
                                    previsaoHtml += `</div></div>`;
                                }

                                previsaoHtml += `
                                    <div class="forecast-day day-${dayCounter % 5}">
                                        <div class="forecast-header">
                                            <h3>${dataFormatada}</h3>
                                        </div>
                                        <div class="forecast-items">
                                `;
                            }

                            previsaoHtml += `
                                <div class="forecast-item">
                                    <div class="time">${time}</div>
                                    <div class="details">
                                        <div class="temperature">üå°Ô∏è ${previsao.temperatura}¬∞C</div>
                                        <div class="weather">‚òÅÔ∏è ${previsao.clima}</div>
                                    </div>
                                </div>
                            `;
                        });

                        previsaoHtml += `</div></div>`;

                        document.getElementById("estado-previsao").innerHTML = previsaoHtml;
                    })
                    .catch(error => console.error("Erro ao obter dados da previs√£o:", error));
            }
        });
    </script>
</body>
</html>

