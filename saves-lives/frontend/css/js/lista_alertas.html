<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lista de Alertas - Saves Lives +</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .alerta {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin: 10px 0;
            width: 80%;
            max-width: 500px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .alerta-info {
            flex-grow: 1;
        }
        button {
            padding: 8px 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button.inativo {
            background-color: #f44336;
        }
    </style>
</head>
<body>
    <h1>Lista de Alertas</h1>
    <div id="alertas-container"></div>

    <script>
async function carregarAlertas() {
    try {
        const response = await fetch("/alertas/lista");
        const data = await response.json();
        const alertasContainer = document.getElementById("alertas-container");
        alertasContainer.innerHTML = "";

        data.alertas.forEach(alerta => {
            const alertaDiv = document.createElement("div");
            alertaDiv.className = "alerta";
            alertaDiv.innerHTML = `
                <p><strong>Nome:</strong> ${alerta.nome}</p>
                <p><strong>Tipo:</strong> ${alerta.tipo}</p>
                <p><strong>Condição:</strong> ${alerta.condicao || "N/A"}</p>
                <p><strong>Estado:</strong> ${alerta.estado}</p>
                <p><strong>Status:</strong> ${alerta.ativo ? "Ativo" : "Inativo"}</p>
                <button onclick="alterarStatus(${alerta.id}, ${!alerta.ativo})">
                    ${alerta.ativo ? "Desativar" : "Ativar"}
                </button>
                <button onclick="deletarAlerta(${alerta.id})" style="background-color: #d9534f; color: white; margin-left: 5px;">
                    Apagar
                </button>
            `;
            alertasContainer.appendChild(alertaDiv);
        });
    } catch (error) {
        console.error("Erro ao carregar alertas:", error);
    }
}

async function alterarStatus(alertaId, novoStatus) {
    try {
        const response = await fetch(`/alertas/${alertaId}/status`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ativo: novoStatus })
        });

        if (response.ok) {
            alert("Status do alerta alterado com sucesso!");
            carregarAlertas(); 
        } else {
            alert("Erro ao alterar o status do alerta.");
        }
    } catch (error) {
        console.error("Erro ao alterar status:", error);
    }
}

async function deletarAlerta(alertaId) {
    if (!confirm("Tem certeza que deseja apagar este alerta?")) return;

    try {
        const response = await fetch(`/alertas/${alertaId}`, {
            method: "DELETE",
        });

        if (response.ok) {
            alert("Alerta apagado com sucesso!");
            carregarAlertas(); 
        } else {
            alert("Erro ao apagar o alerta.");
        }
    } catch (error) {
        console.error("Erro ao apagar alerta:", error);
    }
}
        document.addEventListener("DOMContentLoaded", carregarAlertas);
    </script>
</body>
</html>
