<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Alertas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
        }

        .header {
            background-color: #00509E;
            color: white;
            text-align: center;
            padding: 10px 0;
            font-size: 20px;
        }

        .tabs {
            display: flex;
            background-color: #f4f4f4;
            justify-content: center;
            border-bottom: 2px solid #ccc;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .tab.active {
            border-bottom: 3px solid #00509E;
            color: #00509E;
        }

        .content {
            display: none;
            padding: 20px;
        }

        .content.active {
            display: block;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-size: 14px;
            color: #333;
        }

        input, select {
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        .alerta {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .alerta button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .alerta button:hover {
            background-color: #d32f2f;
        }

        .btn-blue {
            background-color: #4A90E2;
            margin-right: 10px;
        }

        .btn-blue:hover {
            background-color: #00509E;
        }
    </style>
</head>
<body>
    <div class="header">Configuração Alertas</div>

    <div class="tabs">
        <div class="tab active" data-tab="cadastrar-alerta">Cadastrar Alerta</div>
        <div class="tab" data-tab="ver-alertas">Ver Alertas</div>
    </div>

    <div id="cadastrar-alerta" class="content active">
        <div class="container">
            <h2>Cadastrar Alerta</h2>
            
            <form id="form-alerta">
                <label for="alerta-nome">Nome do Alerta</label>
                <input type="text" id="alerta-nome" required>

                <label for="alerta-tipo">Tipo de Alerta</label>
                <select id="alerta-tipo">
                    <option value="Temperatura alta">Temperatura alta</option>
                    <option value="Temperatura baixa">Temperatura baixa</option>
                    <option value="Chuva intensa">Chuva intensa</option>
                </select>

                <label id="condicao-label" for="alerta-condicao">Condição</label>
                <input type="text" id="alerta-condicao">

                <label for="estado">Estado</label>
                <select id="estado">
                    <option value="Todos">Todos os Estados</option>
                    <option value="Acre">Acre</option>
                    <option value="Alagoas">Alagoas</option>
                    <option value="Amapá">Amapá</option>
                    <option value="Amazonas">Amazonas</option>
                    <option value="Bahia">Bahia</option>
                    <option value="Ceará">Ceará</option>
                    <option value="Distrito Federal">Distrito Federal</option>
                    <option value="Espírito Santo">Espírito Santo</option>
                    <option value="Goiás">Goiás</option>
                    <option value="Maranhão">Maranhão</option>
                    <option value="Mato Grosso">Mato Grosso</option>
                    <option value="Mato Grosso do Sul">Mato Grosso do Sul</option>
                    <option value="Minas Gerais">Minas Gerais</option>
                    <option value="Pará">Pará</option>
                    <option value="Paraíba">Paraíba</option>
                    <option value="Paraná">Paraná</option>
                    <option value="Pernambuco">Pernambuco</option>
                    <option value="Piauí">Piauí</option>
                    <option value="Rio de Janeiro">Rio de Janeiro</option>
                    <option value="Rio Grande do Norte">Rio Grande do Norte</option>
                    <option value="Rio Grande do Sul">Rio Grande do Sul</option>
                    <option value="Rondônia">Rondônia</option>
                    <option value="Roraima">Roraima</option>
                    <option value="Santa Catarina">Santa Catarina</option>
                    <option value="São Paulo">São Paulo</option>
                    <option value="Sergipe">Sergipe</option>
                    <option value="Tocantins">Tocantins</option>
                </select>
                
                <label for="alerta-ativo">Status</label>
                <select id="alerta-ativo">
                    <option value="true">Ativo</option>
                    <option value="false">Inativo</option>
                </select>

                <!-- Botões de Navegação -->
                <div class="button-group">
                    <button class="btn-blue" onclick="window.location.href='/'">Voltar</button>
                    <button type="submit">Salvar Alerta</button>
                </div>                
            </form>
        </div>
    </div>

    <div id="ver-alertas" class="content">
        <div class="container">
            <h2>Lista de Alertas</h2>
            <div id="alertas-container"></div>
        </div>
    </div>
    <script>
        document.querySelectorAll(".tab").forEach(tab => {
            tab.addEventListener("click", () => {
                document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
                document.querySelectorAll(".content").forEach(c => c.classList.remove("active"));
                tab.classList.add("active");
                document.getElementById(tab.dataset.tab).classList.add("active");
            });
        });
    
        document.getElementById("alerta-tipo").addEventListener("change", function () {
            const condicaoLabel = document.getElementById("condicao-label");
            const condicaoInput = document.getElementById("alerta-condicao");
            if (this.value === "Chuva intensa") {
                condicaoLabel.style.display = "none";
                condicaoInput.style.display = "none";
            } else {
                condicaoLabel.style.display = "block";
                condicaoInput.style.display = "block";
            }
        });
    
        document.getElementById("form-alerta").addEventListener("submit", async function (event) {
            event.preventDefault();
    
            const nome = document.getElementById("alerta-nome").value;
            const tipo = document.getElementById("alerta-tipo").value;
            const condicao = document.getElementById("alerta-condicao").value || null;
            const estado = document.getElementById("estado").value;
            const ativo = document.getElementById("alerta-ativo").value === "true";
    
            const alerta = {
                nome,
                tipo,
                condicao: tipo === "Chuva intensa" ? null : condicao, 
                estado,
                ativo
            };
    
            try {
                const response = await fetch("/alertas", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(alerta)
                });
                if (response.ok) {
                    alert("Alerta criado com sucesso!");
                    carregarAlertas();
                    document.querySelector('.tab[data-tab="ver-alertas"]').click();
                } else {
                    alert("Erro ao salvar o alerta.");
                }
            } catch (error) {
                console.error(error);
            }
        });
    
        async function carregarAlertas() {
            try {
                const response = await fetch("/alertas/lista");
                const data = await response.json();    
                const alertasContainer = document.getElementById("alertas-container");
            alertasContainer.innerHTML = "";

            data.alertas.forEach(alerta => {
                const alertaDiv = document.createElement("div");
                alertaDiv.className = "alerta";
                alertaDiv.innerHTML = `
                    <p><strong>Nome:</strong> ${alerta.nome}</p>
                    <p><strong>Tipo:</strong> ${alerta.tipo}</p>
                    <p><strong>Condição:</strong> ${alerta.condicao ? alerta.condicao : "Não aplicável"}</p>
                    <p><strong>Estado:</strong> ${alerta.estado}</p>
                    <p><strong>Status:</strong> ${alerta.ativo ? "Ativo" : "Inativo"}</p>
                    <button onclick="alterarStatus(${alerta.id}, ${!alerta.ativo})">
                        ${alerta.ativo ? "Desativar" : "Ativar"}
                    </button>
                    <button class="btn-blue" onclick="deletarAlerta(${alerta.id})" style="margin-left: 10px; background-color: #007BFF;">
                        Deletar
                    </button>
                `;
                alertasContainer.appendChild(alertaDiv);
            });
        } catch (error) {
            console.error("Erro ao carregar alertas:", error);
        }
    }

    async function alterarStatus(alertaId, novoStatus) {
        try {
            const response = await fetch(`/alertas/${alertaId}/status`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ativo: novoStatus })
            });

            if (response.ok) {
                alert("Status do alerta alterado com sucesso!");
                carregarAlertas(); 
            } else {
                alert("Erro ao alterar o status do alerta.");
            }
        } catch (error) {
            console.error("Erro ao alterar status:", error);
        }
    }

    async function deletarAlerta(alertaId) {
        try {
            const response = await fetch(`/alertas/${alertaId}`, {
                method: "DELETE",
                headers: { "Content-Type": "application/json" }
            });

            if (response.ok) {
                alert("Alerta apagado com sucesso!");
                carregarAlertas(); 
            } else {
                alert("Erro ao apagar o alerta.");
            }
        } catch (error) {
            console.error("Erro ao apagar alerta:", error);
        }
    }

    document.addEventListener("DOMContentLoaded", carregarAlertas);
</script>
</body>
</html>
